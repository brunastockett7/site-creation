<main class="container">
  <h1>My Favorites</h1>

  <% if (typeof success_message !== 'undefined' && success_message) { %>
    <p class="notice success" role="status"><%= success_message %></p>
  <% } %>
  <% if (typeof error_message !== 'undefined' && error_message) { %>
    <p class="notice error" role="status"><%= error_message %></p>
  <% } %>

  <% if (!items || items.length === 0) { %>
    <p class="muted">You havenâ€™t saved any vehicles yet.</p>
    <p><a class="pill" href="/inventory">Browse inventory</a></p>
  <% } else { %>
    <p class="muted"><%= items.length %> favorite<%= items.length === 1 ? '' : 's' %></p>

    <ul class="card-grid">
      <% items.forEach((it) => { %>
        <li class="card">
          <a class="thumb" href="/inventory/detail/<%= it.inv_id %>">
            <%
              // ---- Image path normalization ----
              // Accept either:
              //   - just the filename (e.g., "audi-a5-2025.webp")
              //   - "images/filename.webp"
              //   - "/images/filename.webp"
              //   - a full URL (http/https)
              const raw = String(it.inv_image || "");
              const isAbs = /^https?:\/\//i.test(raw);
              const fileOnly = raw.replace(/^\/?images\//, "");
              const imgUrl = isAbs
                ? raw
                : (fileOnly ? `/images/${fileOnly}` : "/images/hero.webp");
            %>
            <img
              src="<%= imgUrl %>"
              alt="Photo of <%= it.inv_year %> <%= it.inv_make %> <%= it.inv_model %>"
              loading="lazy"
            >
          </a>

          <div class="card-body">
            <h3 class="card-title">
              <a href="/inventory/detail/<%= it.inv_id %>">
                <%= it.inv_year %> <%= it.inv_make %> <%= it.inv_model %>
              </a>
            </h3>

            <% if (it.inv_price) { %>
              <p class="price">$<%= Number(it.inv_price).toLocaleString() %></p>
            <% } %>

            <form method="post" action="/account/favorites/remove">
              <input type="hidden" name="inv_id" value="<%= it.inv_id %>">
              <button class="btn" type="submit">Remove</button>
            </form>
          </div>
        </li>
      <% }); %>
    </ul>
  <% } %>
</main>
