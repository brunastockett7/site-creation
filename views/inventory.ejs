<section class="info-block">
  <h2><%= title %></h2>

  <% if (!items || !items.length) { %>
    <p>No inventory found for this classification.</p>
  <% } else { %>
    <% function slug(s){ 
         return String(s).toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,''); 
       } %>

    <ul style="list-style:none;padding:0;margin:0;display:grid;gap:1rem">
      <% items.forEach(it => { 
           // Build a base filename (no extension)
           const base = (it.inv_image && it.inv_image.trim())
             ? it.inv_image.trim().replace(/\.(webp|jpg|jpeg|png)$/i,'')
             : `${slug(it.inv_make)}-${slug(it.inv_model)}-${it.inv_year}`;
      %>

        <li class="info-block" style="background:#fff;padding:1rem;border-radius:8px;display:grid;grid-template-columns:120px 1fr;gap:1rem;align-items:center">
          
          <!-- Thumbnail image with fallbacks -->
          <a href="/inv/detail/<%= it.inv_id %>">
            <picture>
              <source srcset="/images/<%= base %>.webp" type="image/webp">
              <img
                src="/images/<%= base %>.jpg"
                alt="<%= it.inv_year %> <%= it.inv_make %> <%= it.inv_model %>"
                style="width:120px;height:auto;display:block;border-radius:6px;object-fit:cover"
                onerror="this.onerror=null;
                         this.src='/images/<%= base %>.png';
                         this.onerror=function(){ this.src='/images/placeholder.png'; };"
              >
            </picture>
          </a>

          <!-- Vehicle info -->
          <div>
            <h3 style="margin:.25rem 0">
              <a href="/inv/detail/<%= it.inv_id %>" style="text-decoration:none;color:inherit">
                <%= it.inv_year %> <%= it.inv_make %> <%= it.inv_model %>
              </a>
            </h3>
            <p><strong>Price:</strong> <%= utilities.formatPrice(it.inv_price) %></p>
            <p class="miles" style="margin:.1rem 0;color:#555;">
              <strong>Mileage:</strong>
              <%= typeof it.inv_miles !== "undefined" && it.inv_miles !== null 
                    ? utilities.formatMiles(it.inv_miles)
                    : "N/A" %>
            </p>
          </div>
        </li>
      <% }) %>
    </ul>
  <% } %>
</section>
