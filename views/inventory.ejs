<main class="container">
  <h1><%= title || 'Inventory' %></h1>
  <p class="lead">Explore our wide selection of vehicles, from new arrivals to pre-owned gems. Find your perfect match.</p>

  <% if (flash?.error && flash.error.length) { %>
    <div class="flash error" role="alert"><%= flash.error[0] %></div>
  <% } %>
  <% if (flash?.success && flash.success.length) { %>
    <div class="flash success" role="status"><%= flash.success[0] %></div>
  <% } %>

  <% if (!items || !items.length) { %>
    <p class="muted">
      No inventory found for this classification.
      <a href="/inv/type">Browse all vehicles</a>.
    </p>
  <% } else { %>
    <section aria-label="Available Vehicles" class="inventory-grid">
      <% 
        const toSlug = s => String(s || '').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
        
        const normalizeImg = (raw, v) => {
          let r = raw && raw.trim() ? raw.trim() : `${toSlug(v.inv_make)}-${toSlug(v.inv_model)}-${v.inv_year || ''}.webp`;
          if (!r.startsWith("/images/")) r = "/images/" + r;
          return r;
        };
      %>

      <ul class="vehicle-list" role="list">
        <% items.forEach(v => { 
            const img = normalizeImg(v.inv_image, v);  // Normalize image path
            const alt = `Photo of ${v.inv_year} ${v.inv_make} ${v.inv_model}`;
        %>
          <li class="vehicle-card">
            <a class="vehicle-media" href="/inv/detail/<%= v.inv_id %>">
              <img src="<%= img %>" alt="<%= alt %>" loading="lazy" decoding="async" />
            </a>

            <div class="vehicle-info">
              <h3 class="vehicle-title">
                <a href="/inv/detail/<%= v.inv_id %>">
                  <%= v.inv_year %> <%= v.inv_make %> <%= v.inv_model %>
                </a>
              </h3>

              <p class="price"><%= utilities.formatPrice(v.inv_price) %></p>
              <p class="miles"><%= utilities.formatMiles(v.inv_miles) %></p>

              <a class="btn secondary" href="/inv/detail/<%= v.inv_id %>">View Details</a>
            </div>
          </li>
        <% }) %>
      </ul>
    </section>
  <% } %>

  <section class="card">
    <h2>Browse More Vehicles</h2>
    <p>If you're looking for more options, explore our full inventory.</p>
    <a class="btn" href="/inv/type">Browse All Vehicles</a>
  </section>

</main>
